position(16,(4,1),sniper).
position(15,(3,1),normale).
position(14,(5,2),sniper).
position(13,(4,2),normale).
position(12,(3,2),sniper).
position(11,(2,2),sniper).
position(10,(6,3),sniper).
position(9,(5,3),normale).
position(8,(4,3),normale).
position(7,(2,3),normale).
position(6,(1,3),sniper).
position(5,(6,4),normale).
position(4,(4,4),sniper).
position(3,(3,4),normale).
position(2,(2,4),normale).
position(1,(4,5),sniper).

joueur(1,a,c,d,e). %a = tueur, c,d,e = cibles
joueur(2,b,f,g,h).

% init(LPosition,LPerso):- LPosition is
% [2,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16], LPerso is
% [a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p].

init([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]).

deplacer(_,_,[],[],[]).
deplacer(Perso,Position,[_|LPosition], [Perso|LPerso], [Position|LPositionOut]):-deplacer(Perso,Position,LPosition, LPerso,LPositionOut).
deplacer(Perso,Position,[X|LPosition], [Y|LPerso], [X|LPositionOut]):-Y\==Perso, deplacer(Perso,Position,LPosition, LPerso,LPositionOut).

cible(Perso,Joueur):- joueur(Joueur,_,Perso,_,_).
cible(Perso,Joueur):- joueur(Joueur,_,_,Perso,_).
cible(Perso,Joueur):- joueur(Joueur,_,_,_,Perso).

eliminer(_,[],[],[],[]).
eliminer(Perso,[Perso|LPerso],[_|LPosition],LPersoOut,LPositionOut):-eliminer(Perso,LPerso,LPosition,LPersoOut,LPositionOut).
eliminer(Perso,[X|LPerso],[Y|LPosition],[X|LPersoOut], [Y|LPositionOut]):- X\==Perso, eliminer(Perso,LPerso,LPosition,LPersoOut,LPositionOut).


sniper(Tueur,Cible,LPerso,LPosition,LPersoOut,LPositionOut):- recupPosition(Tueur,LPerso,LPosition,CaseTueur),recupPosition(Cible,LPerso,LPosition,CaseCible),position(CaseTueur,(Xt,Yt),sniper),recupPersoListe(LPersoCaseOut,LPerso,LPosition,CaseTueur),length(LPersoCaseOut,1),position(CaseCible,(Xc,Yc),_),testSniper((Xt,Yt),(Xc,Yc)),eliminer(Cible,LPerso,LPosition,LPersoOut,LPositionOut).

testSniper((Xt,_),(Xt,_)).
testSniper((_,Yt),(_,Yt)).

pistolet(Tueur,Cible,LPerso,LPosition,LPersoOut,LPositionOut):- recupPosition(Tueur,LPerso,LPosition,CaseTueur),recupPosition(Cible,LPerso,LPosition,CaseCible),position(CaseTueur,(Xt,Yt),_),recupPersoListe(LPersoCaseOut,LPerso,LPosition,CaseTueur),length(LPersoCaseOut,1),position(CaseCible,(Xc,Yc),_),testPistolet((Xt,Yt),(Xc,Yc)),eliminer(Cible,LPerso,LPosition,LPersoOut,LPositionOut).

testPistolet((Xt,Y),(Xc,Y)):-X is Xt-1, X==Xc.
testPistolet((Xt,Y),(Xc,Y)):-X is Xt+1, X==Xc.
testPistolet((X,Yt),(X,Yc)):-Y is Yt-1, Y==Yc.
testPistolet((X,Yt),(X,Yc)):-Y is Yt+1, Y==Yc.


recupPosition(Perso,[Perso|_],[X|_],X).
recupPosition(Perso,[X|LPerso],[_|LPosition],PositionOut):-X\==Perso,recupPosition(Perso, LPerso,LPosition,PositionOut).

recupPersoListe(Perso,LPerso,LPosition,PositionOut):-findall(X,recupPosition(X,LPerso,LPosition,PositionOut),Perso).

